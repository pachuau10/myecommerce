{% extends 'base.html' %}

{% block title %}Cart — LUXE{% endblock %}

{% block content %}
<div class="container" style="padding-top: 60px; padding-bottom: 100px;">
  <div class="page-hero" style="padding-top: 0; padding-bottom: 40px; border-bottom: none; margin-bottom: 48px;">
    <h1 class="page-title">Your Cart</h1>
    {% if cart %}<p class="page-subtitle">{{ cart_count }} item{{ cart_count|pluralize }} in your bag</p>{% endif %}
  </div>

  {% if cart and products %}
  <div class="cart-layout">
    <!-- Items -->
    <div>
      {% for pid, qty in cart.items %}
      {% with product=products|dictsort:"id" %}
      {% endwith %}
      {% for pid2, product in products.items %}
      {% if pid2|stringformat:"s" == pid %}
      <div class="cart-item">
        <div>
          {% if product.image %}
          <img src="{{ product.image.url }}" alt="{{ product.name }}" class="cart-item-img">
          {% else %}
          <div class="cart-item-img" style="display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-size:40px;color:var(--text-dim);">{{ product.name|first }}</div>
          {% endif %}
        </div>
        <div>
          <p style="font-size:11px;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-dim);margin-bottom:4px;">{{ product.category.name }}</p>
          <a href="{{ product.get_absolute_url }}" class="cart-item-name">{{ product.name }}</a>
          <p class="cart-item-price">${{ product.price }} each</p>
          <p style="font-size: 14px; color: var(--accent); margin-top: 6px;">Subtotal: ${{ product.price|floatformat:2 }} × {{ qty }}</p>
          <div style="margin-top: 16px; display: flex; align-items: center; gap: 16px;">
            <form method="post" action="{% url 'store:update_cart' product.id %}" data-cart-form>
              {% csrf_token %}
              <div class="qty-selector" style="transform: scale(0.9); transform-origin: left;">
                <button type="button" class="qty-btn" data-action="minus">−</button>
                <input type="number" name="quantity" value="{{ qty }}" min="1" max="{{ product.stock }}" class="qty-input">
                <button type="button" class="qty-btn" data-action="plus">+</button>
              </div>
              <button type="submit" style="display:none;">Update</button>
            </form>
            <a href="{% url 'store:remove_from_cart' product.id %}" style="font-size:12px;color:var(--text-dim);letter-spacing:0.1em;text-transform:uppercase;">Remove</a>
          </div>
        </div>
        <div style="text-align: right;">
          <p style="font-family: var(--font-display); font-size: 22px; color: var(--accent);">${{ product.price|floatformat:2 }}</p>
          <p style="font-size:12px;color:var(--text-dim);">× {{ qty }}</p>
        </div>
      </div>
      {% endif %}
      {% endfor %}
      {% endfor %}

      <div style="margin-top: 24px;">
        <a href="{% url 'store:product_list' %}" class="btn btn-ghost">← Continue Shopping</a>
      </div>
    </div>

    <!-- Summary -->
    <div class="cart-summary">
      <h2 class="cart-summary-title">Order Summary</h2>
      <div class="cart-summary-row">
        <span>Subtotal</span>
        <span>${{ total|floatformat:2 }}</span>
      </div>
      <div class="cart-summary-row">
        <span>Shipping</span>
        <span>{% if total >= 100 %}Free{% else %}$9.99{% endif %}</span>
      </div>
      <div class="cart-summary-row">
        <span>Tax (est.)</span>
        <span>${{ total|floatformat:2 }}</span>
      </div>
      <div class="cart-summary-total">
        <span>Total</span>
        <span>${{ total|floatformat:2 }}</span>
      </div>

      {% if user.is_authenticated %}
      <a href="{% url 'store:checkout' %}" class="btn btn-primary btn-full btn-lg" style="margin-top: 24px;">Proceed to Checkout</a>
      {% else %}
      <a href="{% url 'store:login' %}?next={% url 'store:checkout' %}" class="btn btn-primary btn-full btn-lg" style="margin-top: 24px;">Sign In to Checkout</a>
      {% endif %}

      <p style="font-size: 12px; color: var(--text-dim); text-align: center; margin-top: 16px;">
        Secure checkout · 30-day returns
      </p>
    </div>
  </div>

  {% else %}
  <div class="cart-empty">
    <div class="cart-empty-icon">◻</div>
    <h2 style="font-family: var(--font-display); font-size: 40px; font-weight: 300; margin-bottom: 12px;">Your cart is empty</h2>
    <p style="color: var(--text-muted); margin-bottom: 32px;">Discover our curated collection of premium goods.</p>
    <a href="{% url 'store:product_list' %}" class="btn btn-primary btn-lg">Start Shopping</a>
  </div>
  {% endif %}
</div>
{% endblock %}
